@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理平台登录</title>
    <link href="~/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/hplus/css/style.css" rel="stylesheet" />
    <link href="~/hplus/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/hplus/css/animate.min.css" rel="stylesheet" />
    <link href="~/hplus/css/login.css" rel="stylesheet" />

    <!--[if lt IE 8]>
    <meta http-equiv="refresh" content="0;Ie" />
    <![endif]-->
    <script>if (window.top !== window.self) { window.top.location = window.location; }</script>
    <script src="~/js/des.js"></script>
    <script>var encrypt_key = '@ViewBag.key';</script>
</head>
<body class="gray-bg">
    <canvas id="canvas-bg"></canvas>
    <div class="middle-box animated fadeInDown">
        <div>
            <div class="text-center m-b-md" style="font-size:64px">
                COMCMS
            </div>
            <h3>欢迎使用 COMCMS 后台管理平台</h3>
            <form asp-controller="Login" asp-area="AdminCP" asp-action="Login"  id="loginForm" class="m-t" role="form" method="post" asp-antiforgery="true">
                <div class="form-group">
                    <input type="text" name="username" id="username" class="form-control" placeholder="用户名" required="">
                </div>
                <div class="form-group">
                    <input type="password" name="password" id="password" class="form-control" placeholder="密码" required="">
                </div>
                @if (Utils.GetSetting("SystemSetting:AdminLoginWithCode") == "1")
                {
                    <div class="form-group input-group">
                        <input type="text" name="code" id="code" class="form-control" placeholder="验证码" required="">
                        <span class="input-group-addon" style="padding:0px;">
                            <img src="~/VerifyCode/MixVerifyCode" onclick="this.src='/VerifyCode/MixVerifyCode?'+Math.random()" style="cursor:pointer;" />
                        </span>
                    </div>
                }
                <button type="submit" class="btn btn-primary block full-width m-b">登 录</button>
                <p class="text-muted text-center">
                    COMCMS © 2014-@DateTime.Now.Year
                </p>
            </form>
        </div>
    </div>
    <!-- 全局js -->
    <environment names="Development">
        <script src="~/lib/jquery/dist/jquery.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
        <script src="~/js/validation/jquery.validate.js"></script>
        <script src="~/js/validation/messages_zh.js"></script>
        <script src="~/js/layer/layer.js"></script>
        <script src="~/js/jquery.form.js"></script>
        <script src="~/js/rtpost.js"></script>
    </environment>
    <environment names="Staging,Production">
        <script src="~/lib/jquery/dist/jquery.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
        <script src="~/js/validation/jquery.validate.min.js"></script>
        <script src="~/js/validation/messages_zh.min.js"></script>
        <script src="~/js/layer/layer.js"></script>
        <script src="~/js/jquery.form.min.js"></script>
        <script src="~/js/rtpost.js"></script>
    </environment>
    <script>
        $(function () {
            var rules = {
                password: {
                    required: true,
                    minlength: 5
                }
            };
            DoAdminLogin("loginForm", rules);
        });
        // --- 科技感粒子连线动画特效 (原生JS实现，无需引入额外库) ---
        (function() {
            var canvas = document.getElementById('canvas-bg');
            var ctx = canvas.getContext('2d');
            var width, height;
            var particles = [];

            // 特效配置
            var config = {
                count: 80,            // 粒子数量
                dist: 160,            // 连线距离
                radius: 2,            // 粒子大小
                color: '26, 179, 148',// 主色调 RGB (#1ab394)
                speed: 0.8            // 移动速度
            };

            function resize() {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            }

            function Particle() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * config.speed;
                this.vy = (Math.random() - 0.5) * config.speed;
            }

            Particle.prototype.update = function() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > width) this.vx = -this.vx;
                if (this.y < 0 || this.y > height) this.vy = -this.vy;
            };

            Particle.prototype.draw = function() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, config.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(' + config.color + ', 0.6)';
                ctx.fill();
            };

            function init() {
                resize();
                particles = [];
                for (var i = 0; i < config.count; i++) {
                    particles.push(new Particle());
                }
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);

                for (var i = 0; i < particles.length; i++) {
                    var p1 = particles[i];
                    p1.update();
                    p1.draw();

                    for (var j = i + 1; j < particles.length; j++) {
                        var p2 = particles[j];
                        var dx = p1.x - p2.x;
                        var dy = p1.y - p2.y;
                        var dist = Math.sqrt(dx * dx + dy * dy);

                        if (dist < config.dist) {
                            ctx.beginPath();
                            ctx.strokeStyle = 'rgba(' + config.color + ',' + (1 - dist / config.dist) * 0.4 + ')';
                            ctx.lineWidth = 1;
                            ctx.moveTo(p1.x, p1.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);
            init();
            animate();
        })();
    </script>

</body>
</html>